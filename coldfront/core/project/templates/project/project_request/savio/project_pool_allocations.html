{% extends "common/base.html" %}
{% load crispy_forms_tags %}
{% load static %}


{% block title %}
Savio Project Request - Allocation Pooling
{% endblock %}


{% block head %}
{{ wizard.form.media }}
{% endblock %}


{% block content %}
<h1>Savio: Allocation Pooling</h1><hr>

<ol class="breadcrumb">
  <li>Allocation Type: {{ allocation_type }}</li>
  <li>&nbsp;<i class="fas fa-angle-double-right"></i>&nbsp;</li>
  <li>{{ breadcrumb_pi }}</li>
</ol>

<p>You may choose to pool your allocation with an existing project's allocation. Service units would be added to that project, and your users would submit jobs under that project.</p>

<form action="" method="post">
  {% csrf_token %}
  <table>
    {{ wizard.management_form }}
    {% if wizard.form.forms %}
      {{ wizard.form.management_form }}
      {% for form in wizard.form.forms %}
        {{ form|crispy }}
      {% endfor %}
    {% else %}
      {{ wizard.form|crispy }}
    {% endif %}
  </table>
  {% if wizard.steps.prev %}
    <button
        class="btn btn-secondary"
        formnovalidate="formnovalidate"
        name="wizard_goto_step"
        type="submit"
        value="{{ wizard.steps.first }}">
      First Step
    </button>
    <button
        class="btn btn-secondary"
        formnovalidate="formnovalidate"
        name="wizard_goto_step"
        type="submit"
        value="{{ wizard.steps.prev }}">
      Previous Step
    </button>
  {% endif %}
  <input class="btn btn-primary" type="submit" value="Next Step"/>
</form>
<br>

<p>Step {{ wizard.steps.step1 }} of {{ wizard.steps.count }}</p>

<script>

    $('body').on('click', function(e) {
        var target, href;
        target = $(e.target);
        if (e.target.tagName === 'A' && e.target.id !== '') {
            e.preventDefault();

            if (window.confirm("Are you sure you want to leave? You will lose progress on the current form.")) {
                if (e.target.tagName === 'A') {
                    href = target.attr('href');
                } else {
                    href = target.parents('a').first().attr('href');
                }
                window.location.href = href;
            }
        }
    });

</script>

{% endblock %}
